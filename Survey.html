<!-- HARSHA UDUTHA
 G01462111 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMU - CS Department Survey</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="gmu-logo.jpg">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- External CSS file -->
    <link rel="stylesheet" href="Style.css">
</head>

<body>


    <!-- Bootstrap Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">GMU - CS Survey</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" href="#survey">Survey</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <header class="gm-header text-center">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-1">
                    <img src="gmu-logo.jpg" alt="GMU Logo" class="header-logo">
                </div>
                <div class="col-md-5 header-text">
                    <div class="gm-box">
                        <h1>George Mason University</h1>
                        <h5>Computer Science Department Survey</h5>
                    </div>
                </div>
            </div>
        </div>
        <button id="darkModeToggle" class="btn gm-darkmode-btn" style="margin-left: 15px;">Dark Mode</button>
    </header>


    <!-- Greeting Section -->
    <div class="container mt-3">
        <div id="greetingMessage" class="alert alert-primary" role="alert">
            <!-- Greeting will be displayed here -->
        </div>
    </div>

    <!-- Survey from using bootstrap -->
    <div class="container mb-5">
        <section id="survey">
        <h2>We hope you enjoyed your visit to our campus! Could you please take a moment to fill out this survey?</h2>
        <h3 class="mt-4">Survey Form:</h3>
        <form action="CSinfo.html" method="GET" onsubmit="return validateForm()">
            <!-- elements have autocomplete and placeholder attributes for name, netid, address and phone -->
            <!-- Full Name field -->
            <div class="mb-3">
                <label for="name" class="form-label">Full Name:<span class="text-danger">*</span></label>
                <input type="text" id="name" name="name" class="form-control" pattern="^[a-zA-Z]+( [a-zA-Z]+)*$" title="Please enter your full name, with no numbers" autocomplete="name" required autofocus placeholder="Eg: Harsha Udutha">
            </div>

              <!-- Address field -->
            <div class="mb-3">
                <label for="netID" class="form-label">GMU NetID:</label>
                <input type="text" id="netID" name="netID" class="form-control" pattern="^(?![0-9]+$)[a-zA-Z0-9]+$" title="NetID must contain letters and numbers, with no spaces, and cannot be only numbers"  autocomplete="on" placeholder="Eg: hudutha">
            </div>

            <div class="mb-3">
                <label for="address" class="form-label">Street Address:<span class="text-danger">*</span></label>
                <input type="text" id="address" name="address" class="form-control" required autocomplete="address-level1" placeholder="Eg: 26 stardew valley">
            </div>

            <!-- Zipcode field with onblur event -->
            <div class="mb-3">
                <label for="zip" class="form-label">ZIP Code:<span class="text-danger">*</span></label>
                <input type="text" id="zip" name="zip" class="form-control" pattern="[0-9]{5}" title="Five-digit zip code" required placeholder="Eg: 20148" onblur="fetchCityAndState()">
                <small id="zipError" class="text-danger" style="display:none;">Invalid ZIP Code</small>
            </div>

            <!-- City and State placeholders -->
            <div class="mb-3">
                <label class="form-label">City:</label>
                <span id="city" class="form-control">Not populated</span>
            </div>

            <div class="mb-3">
                <label class="form-label">State:</label>
                <span id="state" class="form-control">Not populated</span>
            </div>

            <div class="mb-3">
                <label for="phone" class="form-label">Telephone Number:<span class="text-danger">*</span></label>
                <input type="tel" id="phone" name="phone" class="form-control" pattern="\d{3}[-.\s]?\d{3}[-.\s]?\d{4}" title="Phone number format: 123-456-7890 or 123.456.7890" required>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">E-mail:<span class="text-danger">*</span></label>
                <input type="email" id="email" name="email" class="form-control" required placeholder="Eg: hudutha@gmu.edu">
            </div>

            <div class="mb-3">
                <label for="url" class="form-label">Website URL:<span class="text-danger">*</span></label>
                <input type="url" id="url" name="url" class="form-control" required autocomplete="url" placeholder="Eg: https://www.gmu.edu/">
            </div>

            <div class="mb-3">
                <label for="date" class="form-label">Date of Survey:<span class="text-danger">*</span></label>
                <input type="date" id="date" name="date" class="form-control" required>
            </div>

            <h3>What did you like most about the campus?<span class="text-danger">*</span></h3>
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="liked[]" value="students" id="students" title="Please select one or more">
                    <label class="form-check-label" for="students">Students</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="liked[]" value="location" id="location">
                    <label class="form-check-label" for="location">Location</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="liked[]" value="campus" id="campus">
                    <label class="form-check-label" for="campus">Campus</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="liked[]" value="atmosphere" id="atmosphere">
                    <label class="form-check-label" for="atmosphere">Atmosphere</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="liked[]" value="dorm-rooms" id="dorm-rooms">
                    <label class="form-check-label" for="dorm-rooms">Dorm Rooms</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="liked[]" value="sports" id="sports">
                    <label class="form-check-label" for="sports">Sports</label>
                </div>
            </div>

            <h3>How did you become interested in the university? <span class="text-danger">*</span></h3>
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="interest" value="friends" id="friends" required>
                    <label class="form-check-label" for="friends">Friends</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="interest" value="television" id="television" required>
                    <label class="form-check-label" for="television">Television</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="interest" value="social" id="social" required>
                    <label class="form-check-label" for="social">Social Media</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="interest" value="internet" id="internet" required>
                    <label class="form-check-label" for="internet">Internet</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="interest" value="other" id="other" required>
                    <label class="form-check-label" for="other">Other (please specify):</label>
                    <input type="text" id="other-text" name="other-text" class="form-control" maxlength="100" placeholder="Max 100 characters" disabled>
                </div>
            </div>

            <div class="mb-3">
                <label for="comments" class="form-label">Additional Comments:</label>
                <textarea id="comments" name="comments" class="form-control" rows="4" placeholder="Enter any additional comments or suggestions here..."></textarea>
            </div>

            <h3>Expected High School Graduation Month? <span class="text-danger">*</span></h3>
            <div class="mb-3">
                <label for="graduation-month" class="form-label">Select Month:</label>
                <input list="months" id="graduation-month" name="graduation-month" class="form-control" required>
                <datalist id="months">
                    <option value="January"></option>
                    <option value="February"></option>
                    <option value="March"></option>
                    <option value="April"></option>
                    <option value="May"></option>
                    <option value="June"></option>
                    <option value="July"></option>
                    <option value="August"></option>
                    <option value="September"></option>
                    <option value="October"></option>
                    <option value="November"></option>
                    <option value="December"></option>
                </datalist>
            </div>

            <div class="mb-3">
                <label for="graduation-year" class="form-label">Graduation Year Of Your High School:</label>
                <input type="number" id="graduation-year" name="graduation-year" class="form-control" min="1900" max="2100" required placeholder="YYYY">
            </div>

            <h3>How likely are you to recommend this school to other prospective students? <span class="text-danger">*</span></h3>
            <div class="mb-3">
                <label for="recommendation" class="form-label">You would be</label>
                <select id="recommendation" name="recommendation" class="form-select" required>
                    <option value="" disabled selected>Select an option</option>
                    <option value="very-likely">Very Likely</option>
                    <option value="likely">Likely</option>
                    <option value="unlikely">Unlikely</option>
                </select>
                <label for="recommendation">Recommending this school to others.</label>
            </div>

            <!-- Data input field -->
            <h3>Please enter your Undergraduate marks of any 10 courses: <span class="text-danger">*</span></h3>
            <div class="mb-3">
                <label for="dataField" class="form-label">Data (Enter ten comma-separated numbers between 1 and 100):<span class="text-danger">*</span></label>
                <input type="text" id="dataField" name="dataField" class="form-control" required placeholder="e.g., 5,12,33,45,67,89,34,23,12,56">
                <small class="form-text text-muted">Please enter ten comma-separated numbers.</small>
                <div id="dataError" class="text-danger mt-2" style="display: none;">Please enter exactly ten comma-separated numbers between 1 and 100.</div>
            </div>

            <!-- Output fields for Average and Maximum -->
            <div class="mb-3">
                <label for="average" class="form-label">Average:</label>
                <input type="text" id="average" class="form-control" readonly>
            </div>
            <div class="mb-3">
                <label for="maximum" class="form-label">Maximum:</label>
                <input type="text" id="maximum" class="form-control" readonly>
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
            <button type="reset" class="btn btn-secondary">Reset</button>

        </form>
        </section>
    </div>

    <section style="margin-bottom: 50px;"></section>

    <section id="contact">
        <center><h2>Contact</h2></center>

        <div class="container mt-5">        
            <p>If you have any questions, please contact us at:</p>
            <ul>
                <li>Email: csinfo@gmu.edu</li>
                <li>Phone: 703-993-8850</li>
            </ul></div>
    </section>

    <!-- Footer Section -->
    <footer class="gm-footer text-center mt-5">
        <p>&copy; 2024 George Mason University | Computer Science Department</p>
        <p>Unofficial Page by Harsha Udutha</p>
    </footer>

    <!-- javascript to handle other option and submit -->
    <script>
        // Get radio buttons and the other text elemebts
        const otherRadio = document.getElementById('other');
        const otherTextBox = document.getElementById('other-text');
        const radioButtons = document.querySelectorAll('input[name="interest"]');
        const form = document.querySelector('form');
    
        // Add event listener to the radio buttons to enable/disable the "Other" text box
        radioButtons.forEach(radio => 
        {
            radio.addEventListener('change', function() 
            {
                if (otherRadio.checked) {
                    otherTextBox.disabled = false;  // Enable text box
                } else {
                    otherTextBox.disabled = true;   // Disable text box
                    otherTextBox.value = '';        // Clear text box
                }
            });
        });
    </script>

<!-- importing the darkmode script -->
<script src="darkmode.js"></script>

<script>
    document.querySelector('form').addEventListener('submit', function(event) {
    // Preventing the form from submitting to test autocomplete logic
    event.preventDefault();
});

</script>

<!-- Cookie and Greetings Script -->
<script>
    // Helper function to set a cookie
    function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000)); // Expiration time in days
        document.cookie = name + "=" + value + ";expires=" + date.toUTCString() + ";path=/";
    }

    // Helper function to get a cookie value by name
    function getCookie(name) {
        const nameEQ = name + "=";
        const cookiesArray = document.cookie.split(';');
        for (let i = 0; i < cookiesArray.length; i++) {
            let cookie = cookiesArray[i].trim();
            if (cookie.indexOf(nameEQ) === 0) {
                return cookie.substring(nameEQ.length, cookie.length);
            }
        }
        return null;
    }

    // Function to get appropriate greeting based on the time of day
    function getGreeting() {
        const hours = new Date().getHours();
        if (hours < 12) {
            return "Good Morning";
        } else if (hours < 18) {
            return "Good Afternoon";
        } else {
            return "Good Evening";
        }
    }

    // Function to display the greeting message
    function displayGreeting() {
        const name = getCookie("username");
        const greetingMessageDiv = document.getElementById("greetingMessage");

        if (name) {
            // If a cookie with a name exists, show the greeting
            const greeting = `${getGreeting()} ${name}, welcome to George Mason Computer Science Department Survey!`;
            greetingMessageDiv.innerHTML = greeting + 
                ' <a href="#" onclick="resetCookie()">Not you? Click here to change your name.</a>';
        } else {
            // No cookie set, ask for user's name
            const userName = prompt("Welcome! Please enter your name:");
            if (userName) {
                setCookie("username", userName, 7); // Set cookie for 7 days
                location.reload(); // Reload the page to show the greeting with the name
            } else {
                greetingMessageDiv.textContent = "Welcome to George Mason Computer Science Department Survey! Please enter your name to personalize this page.";
            }
        }
    }

    // Function to reset the cookie and reload the page
    function resetCookie() {
        setCookie("username", "", -1); // Delete the cookie
        location.reload(); // Reload the page to prompt for the name again
    }

    // Run displayGreeting when the page loads
    window.onload = function () {
        displayGreeting();
    };
</script>

<!-- JavaScript for Data Validation, Average, and Maximum Calculation -->
<script>
    const dataField = document.getElementById('dataField');
    const averageField = document.getElementById('average');
    const maximumField = document.getElementById('maximum');
    const dataError = document.getElementById('dataError');

    // Event listener to calculate average and maximum on data field blur
    dataField.addEventListener('blur', function () {
        const data = dataField.value.split(',').map(num => num.trim());

        // Validate that there are exactly 10 numbers
        if (data.length !== 10 || !data.every(isValidNumber)) {
            dataError.style.display = 'block'; // Show error message
            averageField.value = '';
            maximumField.value = '';
            return;
        }

        dataError.style.display = 'none'; // Hide error message

        // Convert valid numbers to an array of integers
        const numbers = data.map(Number);

        // Calculate average and maximum
        const average = calculateAverage(numbers);
        const maximum = Math.max(...numbers);

        // Display results in the output fields
        averageField.value = average.toFixed(2);
        maximumField.value = maximum;
    });

    // Function to validate if a number is between 1 and 100
    function isValidNumber(num) {
        const n = Number(num);
        return !isNaN(n) && n >= 1 && n <= 100;
    }

    // Function to calculate the average
    function calculateAverage(numbers) {
        const sum = numbers.reduce((acc, num) => acc + num, 0);
        return sum / numbers.length;
    }
</script>

<!-- JavaScript for Validation -->
<script>
    function validateForm() {
        let errors = [];

        // Full Name Validation (Alphabet only)
        const nameField = document.getElementById('name');
        const namePattern = /^[a-zA-Z]+( [a-zA-Z]+)*$/;
        if (!namePattern.test(nameField.value)) {
            errors.push("Full Name must contain only alphabets.");
            nameField.value = ""; // Clear field if invalid
        }

        // Address Validation (Alphanumeric with symbols)
        const addressField = document.getElementById('address');
        const addressPattern = /^[a-zA-Z0-9\s,'-]+$/;
        if (!addressPattern.test(addressField.value)) {
            errors.push("Street Address must contain valid characters.");
            addressField.value = ""; // Clear field if invalid
        }

        // Checkbox Validation (At least two must be checked)
        const checkboxes = document.querySelectorAll('input[name="liked[]"]:checked');
        if (checkboxes.length < 2) {
            errors.push("Please select at least two options in 'What did you like most about the campus?'.");
        }

        // Radio Button Validation (At least one option must be selected)
        const radioSelected = document.querySelector('input[name="interest"]:checked');
        if (!radioSelected) {
            errors.push("Please select an option for 'How did you become interested in the university?'.");
        }

        // Display all errors
        if (errors.length > 0) {
            alert(errors.join("\n"));
            return false; // Prevent form submission if there are errors
        }

        return true; // Form is valid, allow submission
    }
</script>


<!-- JavaScript for Ajax call to fetch city and state based on zip -->
<script>
function fetchCityAndState() {
    const zipInput = document.getElementById("zip").value.trim();  // Trim any leading/trailing spaces
    const zipError = document.getElementById("zipError");
    const cityField = document.getElementById("city");
    const stateField = document.getElementById("state");

    // Reset fields
    zipError.style.display = "none";
    cityField.textContent = "Not populated";
    stateField.textContent = "Not populated";

    console.log(`Entered Zipcode: ${zipInput}`); // Debugging log to check the entered zipcode

    if (zipInput.length >= 3 && /^\d+$/.test(zipInput)) {
        // Perform Ajax call to fetch JSON file
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "USCities.json", true);  // Downloaded a US zipcode file from github : https://github.com/millbj92/US-Zip-Codes-JSON/blob/master/USCities.json
        xhr.onload = function () {
            if (xhr.status === 200) {
                const zipData = JSON.parse(xhr.responseText);
                console.log('JSON Data Loaded:', zipData);  // Debugging log for JSON data

                // Find the zipcode from the JSON data
                const matchedZip = zipData.find(item => item.zip_code.toString() === zipInput);
                console.log('Matched Zipcode Object:', matchedZip);  // Debugging log for matched zipcode

                if (matchedZip) {
                    // Populate city and state
                    cityField.textContent = matchedZip.city;
                    stateField.textContent = matchedZip.state;
                    console.log(`Populated City: ${matchedZip.city}, State: ${matchedZip.state}`);  // Debugging log for populated fields
                } else {
                    // Show error if ZIP code is invalid
                    zipError.style.display = "block";
                    console.log("No matching zipcode found in the JSON data");  // Debugging log for invalid zip
                }
            } else {
                console.error("Failed to load USCities.json");  // Log an error if the JSON file can't be loaded
            }
        };
        xhr.onerror = function () {
            console.error("Error making the Ajax request");  // Error handling for failed Ajax request
        };
        xhr.send();
    } else {
        // Show error if ZIP code is not valid
        zipError.style.display = "block";
        console.log("Invalid ZIP Code format entered");  // Debugging log for invalid format
    }
}
</script>

</body>
</html>
